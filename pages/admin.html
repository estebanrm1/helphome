<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Administrador</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
    <link rel="stylesheet" href="../css/style.css">
</head>
<body>
    
    <main>
        <section>
            <h1></h1>
            <article id="panel">

            </article>
        </section>
    </main>



    <script>

        const $panel = document.getElementById('panel');
        const servicios = localStorage.getItem("servicios") || [];
        $panel.appendChild(TablaEB(JSON.parse(servicios), ['editar','eliminar'], {editar:'✏️', eliminar:'🗑️'}));

        $panel.addEventListener('click', (e)=>{
            if(Object.keys(e.target.dataset)[0]){
                console.log(JSON.parse(servicios).find((e)=> e.target.dataset.eliminar))
            }
        })





function TablaEB(data, opciones, icons){
    //dom variables
    const $table = document.createElement('table'); $table.classList.add('table'); $table.classList.add('table-striped');
    const $thead = document.createElement('thead');
    const $tbody = document.createElement('tbody');
    const $trh = document.createElement('tr');

    //variables
    let thead = Object.keys(data[0]).map(th=>{return th.toUpperCase()});
    let standard_columns = thead.length;
    opciones = opciones.map(e=>e.toUpperCase());
    thead = [...thead, ...opciones].map(th=>th.replace(/[_-]+/g, " "));

    //cabecera
    thead.forEach((th)=>{
        let $th = document.createElement('th'); $th.textContent = th;
        $trh.appendChild($th);
    })

    //refactor data - add delete and edit column
    data.forEach((fila, n_fila) => {
        for(let i = 0; i< opciones.length; i++){
            Object.defineProperty(fila, opciones[i].toLowerCase(),
            {
                value: fila._id,
                writable : true,
                enumerable : true,
                configurable : true
            }
            );
        }
    });

    data.forEach((td, n_fila) => {
        
        let $tr = document.createElement('tr');
        let counter = 0;

        for (const property in td){
            if(counter < standard_columns){
                $tr.innerHTML += `<td>${cortarTexto(td[property])}</td>`;
            }else{
                $tr.innerHTML += `<td><button class="btn btn-outline-light" data-${property}="${td['codigo']}">${icons[property]}</button></td>`;
            }
            counter++;
        }
        $tbody.appendChild($tr);
        
    });

    function cortarTexto(texto){
        if(texto.length>25){
            return texto.slice(0,25)+'..';
        }else{
            return texto;
        }
        
    }

    $thead.appendChild($trh);
    $table.appendChild($thead);
    $table.appendChild($tbody);

    return $table;

}


    </script>
</body>
</html>